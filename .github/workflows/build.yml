on:
  pull_request:
    branches:
      - main

name: Build renameat2

jobs:
  manylinux:
    runs-on: ubuntu-20.04

    strategy:
      fail-fast: false
      matrix:
        python:
          - cp36-cp36m
          - cp37-cp37m
          - cp38-cp38m
          - cp39-cp39m
        arch:
          - x86_64
          - i686
          - aarch64

    steps:
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v1

      - uses: actions/checkout@v2

      - name: Build manylinux wheel
        run: |
          if [ "$ARCH" = "aarch64" ]; then
            export PLAT=manylinux2014_aarch64
          fi
          docker-compose -f builder/docker-compose.yml build --pull
          docker-compose -f builder/docker-compose.yml run manylinux build-wheel.sh
        env:
          WHICH_PYTHON: ${{ matrix.python }}
          ARCH: ${{ matrix.arch }}
